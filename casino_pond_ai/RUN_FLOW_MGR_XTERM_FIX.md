# :run_flow_mgr.csh xterm Fix

## Problem

The `:run_flow_mgr.csh` wrapper script generated by `wsm_casino.py` was calling `fm_casino.py` without the `-terminal xterm` flag, causing it to use gnome-terminal by default, which fails with:

```
Error constructing proxy for org.gnome.Terminal:/org/gnome/Terminal/Factory0: The connection is closed
```

## Fix Applied

**File Modified:** `wsm_casino.py` (Lines 345-352)

### Before:
```csh
#!/bin/csh -f

if (-e ./common/flow/flow_casino.yaml) then
    ${casino_pond}/fm_casino.py -flow ./common/flow/flow_casino.yaml -only $1
else
    ${casino_pond}/fm_casino.py -flow ../../common/flow/flow_casino.yaml -only $1
endif
```

### After:
```csh
#!/bin/csh -f

if (-e ./common/flow/flow_casino.yaml) then
    ${casino_pond}/fm_casino.py -flow ./common/flow/flow_casino.yaml -only $1 -terminal xterm
else
    ${casino_pond}/fm_casino.py -flow ../../common/flow/flow_casino.yaml -only $1 -terminal xterm
endif
```

## How to Apply the Fix to Your Existing Run Directory

You have 3 options:

### Option 1: Regenerate the Script (Recommended)

Run the workspace manager to regenerate `:run_flow_mgr.csh`:

```bash
cd /mnt/data/prjs/ANA6716/works_rachel.han/ANA6716/pi___net-2.1_dk-2.2_tag-0.0
python3.12 $casino_pond/wsm_casino.py
# Follow prompts to regenerate run directory scripts
```

### Option 2: Manually Edit Your Existing Script (Quickest)

Edit your existing `:run_flow_mgr.csh` file:

```bash
cd /mnt/data/prjs/ANA6716/works_rachel.han/ANA6716/pi___net-2.1_dk-2.2_tag-0.0/runs/01_net-02_FP-fe00_te00_pv00
vi :run_flow_mgr.csh
```

Add `-terminal xterm` to both fm_casino.py command lines:

```csh
#!/bin/csh -f

if (-e ./common/flow/flow_casino.yaml) then
    ${casino_pond}/fm_casino.py -flow ./common/flow/flow_casino.yaml -only $1 -terminal xterm
else
    ${casino_pond}/fm_casino.py -flow ../../common/flow/flow_casino.yaml -only $1 -terminal xterm
endif
```

### Option 3: Call fm_casino.py Directly (Bypass Wrapper)

Instead of using `:run_flow_mgr.csh`, call `fm_casino.py` directly:

```bash
cd /mnt/data/prjs/ANA6716/works_rachel.han/ANA6716/pi___net-2.1_dk-2.2_tag-0.0/runs/01_net-02_FP-fe00_te00_pv00
python3.12 $casino_pond/fm_casino.py -only sta_pt -y -terminal xterm
```

## Testing

After applying the fix (using any option above), run:

```bash
:run_flow_mgr.csh sta_pt
```

You should see:
```
Using terminal: xterm
```

Instead of:
```
Using terminal: gnome-terminal
```

And the task should execute without the D-Bus proxy error.

## Related Files

- `wsm_casino.py` (Lines 337-360) - Script generator
- `STA_PT_FIX_APPLIED.md` - sta_pt script fixes documentation
- `:run_flow_mgr.csh` - Generated wrapper script (in each run directory)

## Summary

- ✅ `wsm_casino.py` now generates scripts with `-terminal xterm` flag
- ✅ New run directories will automatically get the fixed script
- ⚠️ Existing run directories need manual update (use Option 2 above for quickest fix)
